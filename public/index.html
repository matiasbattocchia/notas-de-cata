<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notas de cata</title>
  <link rel="icon" type="image/svg+xml" href="img/wine.svg">
  <link rel="stylesheet" href="https://unpkg.com/chota@latest">
</head>
<body>
<div id="app">

<nav>
  <a href="#">
    <img height="20" width="20" src="img/wine.svg">
    <span>Notas de cata</span>
  </a>
  <a href="#Notas">Notas</a>
  <a href="#Nueva nota" @click="nuevaNota">Nueva nota</a>

  <div v-if="usuarie">
    <span>{{ usuarie.displayName }}</span>
    <img height="20" width="20" :src="usuarie.photoURL">
  </div>
  <button v-else @click="entrar">Entrar</button>
</nav>


<form @submit.prevent="guardarNota">
  <h1>Nueva nota</h1>

  <label>
    Fecha
    <input v-model="nota.fecha" type="date">
  </label>

  <section>
    <h2>Vino</h2>

    <fieldset>
      <legend>Variedad</legend>
      <label v-for="(_, id) of variedades">
        <input v-model="nota.variedad" type="radio" :value="id">
        {{ id.capitalize() }}
      </label>
    </fieldset>

    <label>
      Varietales
      <select multiple v-model="nota.varietales">
        <option v-for="(_, id) of varietalesDeLaVariedad" :value="id">{{ id.capitalize() }}</option>
      </select>
    </label>

    <label>
      Productor
      <input v-model.trim="nota.productor" type="text" placeholder="Escala humana">
    </label>

    <label>
      Línea
      <input v-model.trim="nota.línea" type="text" placeholder="Livverá">
    </label>

    <label>
      Nombre
      <input v-model.trim="nota.nombre" type="text" placeholder="Malbec">
    </label>

    <label>
      Cosecha
      <input v-model.trim="nota.cosecha" type="number" placeholder="2019">
    </label>
  </section>

  <section>
    <h2>Ver</h2>

    <fieldset>
      <legend>Color</legend>
      <label v-for="({ código }, id) of coloresDeLaVariedad" :style="{ color: código }">
        <input v-model="nota.color" type="radio" :value="id">
        {{ id.capitalize() }}
      </label>
    </fieldset>
  </section>

  <section>
    <h2>Oler y gustar</h2>

    <fieldset v-for="({ descriptor }, id) of saboresDelVarietal">
      <legend><i>{{ descriptor.capitalize() }}</i> &gt {{ id.capitalize() }}</legend>
      <img height="64" width="64" :src="`img/${ id.replace(/ /g,'-') }.svg`">
      <input v-model="nota.sabores" type="checkbox" :value="id">
    </fieldset>
  </section>

  <section>
    <h2>Estructura</h2>

    <fieldset v-for="(mapa, id) of estructura">
      <legend>{{ id.capitalize() }}</legend>
      <img height="64" width="64">
      <label>
        {{ [ 'seleccionar...', ...mapa ][$root[id]].capitalize() }}
        <input v-model.number="$root[id]" type="range" max="3">
      </label>
    </fieldset>
  </section>

  <section>
    <h2>Observaciones</h2>
    <textarea v-model.trim="nota.observaciones" rows="4" placeholder="..."></textarea>

    <fieldset>
      <legend>Puntaje</legend>

      <label>
        <input v-model.number="nota.puntaje" type="radio" value="1">
        :(
      </label>

      <label>
        <input v-model.number="nota.puntaje" type="radio" value="3">
        :|
      </label>

      <label>
        <input v-model.number="nota.puntaje" type="radio" value="5">
        :)
      </label>
    </fieldset>
  </section>

  <button type="submit">Guardar</button>
  <button @click="borrarNota">Borrar</button>
</form>

<h1>Notas</h1>

<table>
  <thead>
    <tr>
      <th>Vino</th>
      <th>Variedad</th>
      <th>Varietales</th>
    </tr>
  </thead>
  <tbody>
    <tr v-for="(nota, id) of notas" @click="mostrarNota(id)">
      <td>{{ [nota.productor, nota.línea, nota.nombre, nota.cosecha].filter(Boolean).join(' ') }}</td>
      <td>{{ nota.variedad ? nota.variedad.capitalize() : '' }}</td>
      <td>{{ nota.varietales.map(varietal => varietal.capitalize()).join(', ') }}</td>
    </tr>
  </tbody>
</table>

</div>

<script src="/__/firebase/7.10.0/firebase-app.js"></script>
<script src="/__/firebase/7.10.0/firebase-auth.js"></script>
<script src="/__/firebase/7.10.0/firebase-firestore.js"></script>
<script src="/__/firebase/init.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="js/index.js"></script>
</body>
</html>
